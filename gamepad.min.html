<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>body{font-family:Arial,sans-serif;margin:0;padding:20px;user-select:none}.a{max-width:1000px;margin:0 auto;padding:20px;border:1px solid #ccc}.b{display:flex;justify-content:space-between;align-items:center;gap:40px;min-height:400px}.c,.d,.e{flex:1;display:flex;flex-direction:column;align-items:center;gap:20px}.f{position:relative;width:150px;height:150px;border:2px solid #333;border-radius:50%}.g{position:absolute;width:50px;height:50px;background:#666;border:2px solid #333;border-radius:50%;cursor:grab;top:50%;left:50%;transform:translate(-50%,-50%)}.h,.i{width:50px;height:120px;background:#f5f5f5;border:2px solid #333;position:relative}.j{width:150px;height:50px;background:#f5f5f5;border:2px solid #333;position:relative}.k{width:50px;height:100px;background:#f5f5f5;border:2px solid #333;position:relative}.l,.m,.n{position:absolute;width:48px;height:27px;background:#666;border:1px solid #333;cursor:grab;left:50%;transform:translateX(-50%)}.o{position:absolute;width:27px;height:48px;background:#666;border:1px solid #333;cursor:grab;top:50%;transform:translateY(-50%)}.g:active,.g.p,.l:active,.m:active,.n:active,.o:active,.l.p,.m.p,.n.p,.o.p{cursor:grabbing}.q,.r{display:flex;gap:30px;align-items:center}.s{font-size:12px;text-align:center;margin-bottom:5px}.t{padding:10px 20px;margin:5px;background:#f0f0f0;border:1px solid #333;cursor:pointer}#u{text-align:center;margin:5px 0;padding:5px}.v{position:absolute;top:20px;right:20px;padding:12px 24px;font-size:16px;font-weight:bold;background:#667eea;color:white;border:none;border-radius:8px;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all 0.3s ease}.v:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}.v.w{display:none}.x{position:fixed;right:20px;width:400px;background:white;border:2px solid #333;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,0.3);display:none;z-index:999;padding:15px}.x.y{display:block}.z{display:grid;grid-template-columns:repeat(5,1fr);grid-template-rows:repeat(2,1fr);gap:8px;height:200px}.A{border:2px dashed #ccc;border-radius:5px;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer;font-size:12px;color:#666;background:#f9f9f9}.A.B{border:2px solid #4CAF50;background:#e8f5e8;color:#333}.C{font-size:10px;color:#999;margin-top:4px;text-align:center}.A.D{transform:scale(0.95);background:#ffeb3b;border-color:#ff9800;animation:E 0.8s ease-in-out}.A.F{background:#f44336;color:white;border-color:#d32f2f}@keyframes E{0%{box-shadow:0 0 0 0 rgba(255,152,0,0.7)}70%{box-shadow:0 0 0 10px rgba(255,152,0,0)}100%{box-shadow:0 0 0 0 rgba(255,152,0,0)}}.G{display:none}.H{max-width:1000px;width:100%;margin:0 auto 20px auto;background:#f9f9f9;border:2px solid #333;border-radius:5px;padding:15px;display:none}.H.y{display:block}.I{border:1px solid #ccc;border-radius:5px;padding:0px;margin:10px 0}.J{display:flex;justify-content:space-between;align-items:center;padding:8px;margin:5px 0;background:#f5f5f5;border-radius:3px}.K{display:flex;gap:10px;margin:10px 0}.K button{padding:8px 16px;border:1px solid #333;background:#f0f0f0;cursor:pointer;border-radius:3px}.K button:hover{background:#e0e0e0}.L{color:red;cursor:pointer;padding:2px 6px;border:1px solid red;border-radius:3px;background:white}</style></head><body><button class="v" onclick="M()">编排</button><div id="H" class="H"><div class="I" id="I"></div><div class="K"><button onclick="N()">添加动作</button><button onclick="O()">停止运动</button><button onclick="P()">添加延时</button><button onclick="Q(R)">演示</button><button onclick="S()">清空</button><button onclick="T()">保存</button><button onclick="U()">关闭</button></div></div><div id="x" class="x"><div class="z" id="z"></div><div class="import-export-btns"><button class="small-btn" onclick="V()">导出</button><button class="small-btn" onclick="W()">导入</button><input type="file" id="X" class="G" accept=".json" onchange="Y(event)"></div></div><div class="a"><div class="b"><div class="c"><button class="t" onclick="Z()">回中心</button><div class="f" id="a0"><div class="g" id="a1"></div></div><div id="u">控制器就绪</div></div><div class="d"><div><div class="s"></div><div class="r"><div><div class="s">左眼</div><div class="i"><div class="m" data-servo="4" data-min="30" data-max="150" data-value="90"></div></div></div><div><div class="s">右眼</div><div class="i"><div class="m" data-servo="5" data-min="30" data-max="150" data-value="90"></div></div></div></div></div><div><div class="s">头部</div><div class="k"><div class="n" data-servo="7" data-min="30" data-max="150" data-value="90"></div></div></div></div><div class="e"><div><div class="s">脖子</div><div class="j"><div class="o" data-servo="6" data-min="0" data-max="180" data-value="90"></div></div></div><div><div class="s"></div><div class="q"><div><div class="s">左手</div><div class="h"><div class="l" data-servo="2" data-min="0" data-max="180" data-value="90"></div></div></div><div><div class="s">右手</div><div class="h"><div class="l" data-servo="3" data-min="0" data-max="180" data-value="90"></div></div></div></div></div></div></div></div><script>let a2=false;let a3={x:0,y:0};let a4=75;let a5=25;let a6={x:0,y:0};let a7=null;let a8=null;let a9={type:"",speed:0};let b0={};let R=null;const a0=document.getElementById('a0');const a1=document.getElementById('a1');const b1=document.querySelectorAll('.l, .m, .n, .o');function b2(){if(a7){clearTimeout(a7);a7=null}}function b3(b4,b5,b6){const b7=parseInt(getComputedStyle(b4)[b6?'width':'height']);const b8=b5[b6?'clientWidth':'clientHeight']-4;const b9=b8-b7;return{handleSize:b7,containerSize:b8,maxPosition:b9}}function c0(b4,c1,b6,c2){if(b6){const c3=(c1/180)*(c2.containerSize-c2.handleSize);b4.style.left=c3+'px'}else{const c3=c2.containerSize-((c1/180)*(c2.containerSize-c2.handleSize));b4.style.top=(c3-27)+'px'}}function c4(){const c5=a0.getBoundingClientRect();a3.x=c5.width/2;a3.y=c5.height/2}function c6(c7=90){b1.forEach(c8=>{const b5=c8.parentElement;const b6=c8.classList.contains('o');const c2=b3(c8,b5,b6);c0(c8,c7,b6,c2)})}function c9(d0,d1){const d2=d0-a3.x;const d3=d1-a3.y;const d4=Math.sqrt(d2*d2+d3*d3);const d5=a4-a5;let d6=d2;let d7=d3;if(d4>d5){const d8=d5/d4;d6=d2*d8;d7=d3*d8}a1.style.transform=`translate(${d6-a5}px, ${d7-a5}px)`;const d9=d6/d5;const e0=-d7/d5;a6.x=d9;a6.y=e0;e1(d9,e0)}function e1(d0,d1){b2();const e2=Math.sqrt(d0*d0+d1*d1);let e3="";let e4=0;if(e2<0.1){e3="stop";e4=0}else{e4=Math.min(Math.floor(e2*100),100);if(Math.abs(d1)>Math.abs(d0)){e3=d1>0?"move_forward":"move_backward"}else{e3=d0>0?"turn_right":"turn_left"}}e5(e3,e4);a7=setTimeout(()=>{if(a2){e1(a6.x,a6.y)}},300)}function e6(){a1.style.transform='translate(-50%, -50%)';a6.x=0;a6.y=0;b2();e5("stop","0")}function e7(b4,e8){const e9=parseInt(b4.dataset.servo);const f0=parseInt(b4.dataset.min);const f1=parseInt(b4.dataset.max);e8=Math.max(f0,Math.min(f1,e8));b4.dataset.value=e8}function f2(b4,f3,f4){const b5=b4.parentElement;const f5=b5.getBoundingClientRect();const b6=b4.classList.contains('o');const b7=parseInt(getComputedStyle(b4)[b6?'width':'height']);const b8=f5[b6?'width':'height']-4;const b9=b8-b7;let f6,f7,c1;if(b6){f6=f3-f5.left-2-(b7/2);f7=Math.max(0,Math.min(b9,f6));c1=Math.round((f7/b9)*18)*10;b4.style.left=(f7-2)+'px'}else{f6=f4-f5.top-2-(b7/2);f7=Math.max(0,Math.min(b9,f6));c1=Math.round((1-(f7/b9))*18)*10;b4.style.top=(f7-2)+'px'}e7(b4,c1)}function f8(){a1.addEventListener('mousedown',(f9)=>{a2=true;a1.classList.add('p');f9.preventDefault()});document.addEventListener('mousemove',(f9)=>{if(a2){const f5=a0.getBoundingClientRect();c9(f9.clientX-f5.left,f9.clientY-f5.top)}if(a8){f2(a8,f9.clientX,f9.clientY)}});document.addEventListener('mouseup',()=>{if(a2){a2=false;a1.classList.remove('p');setTimeout(()=>{if(!a2)e6()},100)}if(a8){a8.classList.remove('p');const e9=parseInt(a8.dataset.servo);const g0=parseInt(a8.dataset.value);e5(e9,g0);a8=null}});b1.forEach(b4=>{b4.addEventListener('mousedown',(f9)=>{a8=b4;b4.classList.add('p');f9.preventDefault();f9.stopPropagation()})});a1.addEventListener('touchstart',(f9)=>{a2=true;a1.classList.add('p');f9.preventDefault()});document.addEventListener('touchmove',(f9)=>{if(a2){const g1=f9.touches[0];const f5=a0.getBoundingClientRect();c9(g1.clientX-f5.left,g1.clientY-f5.top)}if(a8){const g1=f9.touches[0];f2(a8,g1.clientX,g1.clientY)}f9.preventDefault()});document.addEventListener('touchend',()=>{if(a2){a2=false;a1.classList.remove('p');setTimeout(()=>{if(!a2)e6()},100)}if(a8){a8.classList.remove('p');const e9=parseInt(a8.dataset.servo);const g0=parseInt(a8.dataset.value);e5(e9,g0);a8=null}});b1.forEach(b4=>{b4.addEventListener('touchstart',(f9)=>{a8=b4;b4.classList.add('p');f9.preventDefault();f9.stopPropagation()})})}function Z(){e6();c6();e5('home','0')}function e5(g2,g3){const g4=`${g2}:${g3}`;if(g2!==a9.type||Math.abs(g3-a9.speed)>=10){console.log('发送命令:',g4);document.getElementById('u').textContent='发送: '+g4;if(g2!=='stop'){a9={type:g2,speed:g3}}fetch('/control',{method:'POST',body:g4}).then(g5=>{if(g5.ok){document.getElementById('u').textContent='执行: '+g4}}).catch(g6=>{console.error('发送命令失败:',g6)})}}function M(){const g7=document.getElementById('x');const g8=document.querySelector('.v');g7.classList.toggle('y');if(g7.classList.contains('y')){g9();g8.classList.add('w')}else{g8.classList.remove('w')}}function g9(){const h0=localStorage.getItem('welle_quick_actions');if(h0){b0=JSON.parse(h0)}const z=document.getElementById('z');z.innerHTML='';for(let h1=1;h1<=10;h1++){const h2=document.createElement('div');h2.className='A';h2.dataset.slot=h1;if(b0[h1]){h2.classList.add('B');h2.innerHTML=`<div class="slot-name">${b0[h1].name}</div><div class="slot-info">${b0[h1].steps}步</div>`;let h3;let h4=false;const h5=(f9)=>{f9.preventDefault();h4=false;h2.classList.add('D');h3=setTimeout(()=>{h4=true;h2.classList.remove('D');h2.classList.add('F');if(navigator.vibrate){navigator.vibrate(50)}document.getElementById('x').classList.remove('y');h6(h1)},800)};const h7=(f9)=>{f9.preventDefault();clearTimeout(h3);h2.classList.remove('D','F');if(!h4){Q(h1)}};const h8=()=>{clearTimeout(h3);h2.classList.remove('D','F');h4=false};h2.addEventListener('mousedown',h5);h2.addEventListener('touchstart',h5);h2.addEventListener('mouseup',h7);h2.addEventListener('touchend',h7);h2.addEventListener('mouseleave',h8);h2.addEventListener('touchcancel',h8);h2.oncontextmenu=(f9)=>f9.preventDefault()}else{h2.innerHTML=`<div>插槽 ${h1}</div><div class="slot-info">空</div>`;h2.onclick=()=>h9(h1)}z.appendChild(h2)}}function h9(i0){const i1=prompt('动作名称:');if(!i1)return;b0[i0]={name:i1,commends:[],steps:0};document.getElementById('x').classList.remove('y');h6(i0)}async function Q(i0){const i2=b0[i0];if(!i2)return;for(const i3 of i2.commends){if(i3.action==="delay"){await new Promise(i4=>setTimeout(i4,i3.angle*1000))}else{e5(i3.action,i3.angle);await new Promise(i4=>setTimeout(i4,100))}}}function V(){const i5={Actions:b0,exportTime:new Date().toISOString(),version:'1.0'};const i6=new Blob([JSON.stringify(i5,null,2)],{type:'application/json'});const i7=URL.createObjectURL(i6);const i8=document.createElement('a');i8.href=i7;i8.download=`welle_quick_actions_${new Date().toISOString().split('T')[0]}.json`;i8.click();URL.revokeObjectURL(i7)}function W(){document.getElementById('X').click()}function Y(i9){const j0=i9.target.files[0];if(!j0)return;const j1=new FileReader();j1.onload=function(f9){try{const i5=JSON.parse(f9.target.result);if(i5.Actions){if(confirm('导入会覆盖现有快速动作，确定继续吗？')){b0=i5.Actions;localStorage.setItem('welle_quick_actions',JSON.stringify(b0));g9();alert('快速动作导入成功')}}else{alert('无效的文件格式')}}catch(j2){alert('文件解析失败')}};j1.readAsText(j0);i9.target.value=''}function h6(i0){R=i0;const i2=b0[i0];const g8=document.querySelector('.v');document.getElementById('H').classList.add('y');g8.classList.add('w');j3()}function U(){const g8=document.querySelector('.v');document.getElementById('H').classList.remove('y');g8.classList.remove('w');R=null}function N(){if(!a9.type||!R){alert('请先执行一个命令，然后再添加到编排中');return}const i2=b0[R];i2.commends.push({action:a9.type,angle:a9.speed});i2.steps=i2.commends.length;j3()}function O(){const i2=b0[R];i2.commends.push({action:'stop',angle:0});i2.steps=i2.commends.length;j3()}function P(){const j4=prompt('延时秒数:');if(!j4||isNaN(j4))return;const i2=b0[R];i2.commends.push({action:'delay',angle:parseFloat(j4)});i2.steps=i2.commends.length;j3()}function j3(){const i2=b0[R];const j5=document.getElementById('I');j5.innerHTML='';i2.commends.forEach((i3,j6)=>{const j7=document.createElement('div');j7.className='J';if(i3.action==='delay'){j7.innerHTML=`<span>步骤 ${j6+1}: 延时 ${i3.angle} 秒</span>`}else{j7.innerHTML=`<span>步骤 ${j6+1}: ${i3.action}:${i3.angle}</span>`}j7.innerHTML+=`<span class="L" onclick="j8(${j6})">删除</span>`;j5.appendChild(j7)})}function j8(j6){const i2=b0[R];i2.commends.splice(j6,1);i2.steps=i2.commends.length;j3()}function S(){const i2=b0[R];i2.name='';i2.commends=[];i2.steps=0;j3()}function T(){localStorage.setItem('welle_quick_actions',JSON.stringify(b0));U()}document.addEventListener('click',function(f9){const g7=document.getElementById('x');const g8=document.querySelector('.v');if(g7.classList.contains('y')&&!g7.contains(f9.target)&&!g8.contains(f9.target)){g7.classList.remove('y');g8.classList.remove('w')}});window.onload=function(){c4();c6();f8();g9()};</script></body></html>