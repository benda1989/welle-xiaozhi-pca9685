<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><style>body{font-family:Arial,sans-serif;margin:0;padding:20px;user-select:none}.a{max-width:1000px;margin:0 auto;padding:20px;border:1px solid #ccc}.b{display:flex;justify-content:space-between;align-items:center;gap:40px;min-height:400px}.c,.d,.e{flex:1;display:flex;flex-direction:column;align-items:center;gap:20px}.f{position:relative;width:150px;height:150px;border:2px solid #333;border-radius:50%}.g{position:absolute;width:50px;height:50px;background:#666;border:2px solid #333;border-radius:50%;cursor:grab;top:50%;left:50%;transform:translate(-50%,-50%)}.h,.i{width:50px;height:120px;background:#f5f5f5;border:2px solid #333;position:relative}.j{width:150px;height:50px;background:#f5f5f5;border:2px solid #333;position:relative}.k{width:50px;height:100px;background:#f5f5f5;border:2px solid #333;position:relative}.l,.i div,.k div{position:absolute;width:48px;height:27px;background:#666;border:1px solid #333;cursor:grab;left:50%;transform:translateX(-50%)}.m{position:absolute;width:27px;height:48px;background:#666;border:1px solid #333;cursor:grab;top:50%;transform:translateY(-50%)}.g:active,.g.n,.l:active,.i div:active,.k div:active,.m:active,.l.n,.i div.n,.k div.n,.m.n{cursor:grabbing}.o,.p{display:flex;gap:30px;align-items:center}.q{font-size:12px;text-align:center;margin-bottom:5px}.r{font-size:14px;font-weight:bold;text-align:center;margin-top:5px}.s{padding:10px 20px;margin:5px;background:#f0f0f0;border:1px solid #333;cursor:pointer;font-size:14px}#t{text-align:center;margin:15px 0;padding:10px;border:1px solid #ccc;font-size:14px}</style></head><body><div class="a"><div class="b"><div class="c"><button class="s" onclick="A()">回中心</button><div class="f" id="u"><div class="g" id="v"></div></div><div id="t">控制器就绪</div></div><div class="d"><div><div class="q"></div><div class="p"><div><div class="q">左眼</div><div class="i"><div data-servo="4" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s4_val">90°</div></div><div><div class="q">右眼</div><div class="i"><div data-servo="5" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s5_val">90°</div></div></div></div><div><div class="q">头部</div><div class="k"><div data-servo="7" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s7_val">90°</div></div></div><div class="e"><div><div class="q">脖子</div><div class="j"><div class="m" data-servo="6" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s6_val">90°</div></div><div><div class="q"></div><div class="o"><div><div class="q">左手</div><div class="h"><div class="l" data-servo="2" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s2_val">90°</div></div><div><div class="q">右手</div><div class="h"><div class="l" data-servo="3" data-min="0" data-max="180" data-value="90"></div></div><div class="r" id="s3_val">90°</div></div></div></div></div></div></div><script>let w=0,x={x:0,y:0},z=75,y=25,u={x:0,y:0},n,m,h={type:"",speed:0};const a=document.getElementById('u'),b=document.getElementById('v'),c=document.querySelectorAll('.l,.i div,.k div,.m');function d(){n&&(clearTimeout(n),n=0)}function e(s,t,r){const i=parseInt(getComputedStyle(s)[r?'width':'height']),o=t[r?'clientWidth':'clientHeight']-4,p=o-i;return{a:i,b:o,c:p}}function f(s,t,r,i){if(r){const o=(t/180)*(i.b-i.a);s.style.left=o+'px'}else{const o=i.b-(t/180)*(i.b-i.a);s.style.top=(o-27)+'px'}}function g(){const s=a.getBoundingClientRect();x.x=s.width/2,x.y=s.height/2}function k(s=90){c.forEach(t=>{const r=t.parentElement,i=t.classList.contains('m'),o=e(t,r,i);f(t,s,i,o)})}function l(s,t){const r=s-x.x,i=t-x.y,o=Math.sqrt(r*r+i*i),p=z-y;let q=r,v=i;if(o>p){const s=p/o;q=r*s,v=i*s}b.style.transform=`translate(${q-y}px,${v-y}px)`;const c=q/p,d=-v/p;u.x=c,u.y=d,j(c,d)}function j(s,t){d();const r=Math.sqrt(s*s+t*t);let i="",o=0;if(r<.1)i="stop",o=0;else{o=Math.min(Math.floor(r*100),100);Math.abs(t)>Math.abs(s)?i=t>0?"move_forward":"move_backward":i=s>0?"turn_right":"turn_left"}const p=i!==h.type||Math.abs(o-h.speed)>=10;p&&(v(i,o),h={type:i,speed:o}),n=setTimeout(()=>{w&&j(u.x,u.y)},300)}function o(){b.style.transform='translate(-50%,-50%)',u.x=0,u.y=0,d(),h.type&&"stop"!==h.type&&(v("stop","0"),h={type:"stop",speed:0})}function p(s,t){const r=parseInt(s.dataset.servo),i=parseInt(s.dataset.min),o=parseInt(s.dataset.max);t=Math.max(i,Math.min(o,t)),s.dataset.value=t,document.getElementById(`s${r}_val`).textContent=`${t}°`}function q(s,t,r){const i=s.parentElement,o=i.getBoundingClientRect(),a=s.classList.contains('m'),b=parseInt(getComputedStyle(s)[a?'width':'height']),c=o[a?'width':'height']-4,d=c-b;let f,g,h;a?(f=t-o.left-2-b/2,g=Math.max(0,Math.min(d,f)),h=10*Math.round(g/d*18),s.style.left=(g-2)+'px'):(f=r-o.top-2-b/2,g=Math.max(0,Math.min(d,f)),h=10*Math.round((1-g/d)*18),s.style.top=(g-2)+'px'),p(s,h)}function r(){b.addEventListener('mousedown',s=>{w=1,b.classList.add('n'),s.preventDefault()}),document.addEventListener('mousemove',s=>{if(w){const t=a.getBoundingClientRect();l(s.clientX-t.left,s.clientY-t.top)}m&&q(m,s.clientX,s.clientY)}),document.addEventListener('mouseup',()=>{if(w&&(w=0,b.classList.remove('n'),setTimeout(()=>{w||o()},100)),m){m.classList.remove('n');const s=parseInt(m.dataset.servo),t=parseInt(m.dataset.value);v(s,t),m=0}}),c.forEach(s=>{s.addEventListener('mousedown',t=>{m=s,s.classList.add('n'),t.preventDefault(),t.stopPropagation()})}),b.addEventListener('touchstart',s=>{w=1,b.classList.add('n'),s.preventDefault()}),document.addEventListener('touchmove',s=>{if(w){const t=s.touches[0],r=a.getBoundingClientRect();l(t.clientX-r.left,t.clientY-r.top)}if(m){const t=s.touches[0];q(m,t.clientX,t.clientY)}s.preventDefault()}),document.addEventListener('touchend',()=>{if(w&&(w=0,b.classList.remove('n'),setTimeout(()=>{w||o()},100)),m){m.classList.remove('n');const s=parseInt(m.dataset.servo),t=parseInt(m.dataset.value);v(s,t),m=0}}),c.forEach(s=>{s.addEventListener('touchstart',t=>{m=s,s.classList.add('n'),t.preventDefault(),t.stopPropagation()})})}function A(){o(),k(),v('home','0')}function v(s,t){const r=`${s}:${t}`;console.log('发送命令:',r),document.getElementById('t').textContent='发送: '+r,fetch('/control',{method:'POST',body:r}).then(s=>{s.ok&&(document.getElementById('t').textContent='执行: '+r)}).catch(s=>{console.error('发送命令失败:',s)})}window.onload=function(){g(),k(),r()}</script></body></html>